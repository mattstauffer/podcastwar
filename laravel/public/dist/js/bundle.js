!function e(i,o,n){function t(r,c){if(!o[r]){if(!i[r]){var s="function"==typeof require&&require;if(!c&&s)return s(r,!0);if(u)return u(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var a=o[r]={exports:{}};i[r][0].call(a.exports,function(e){var o=i[r][1][e];return t(o?o:e)},a,a.exports,e,i,o,n)}return o[r].exports}for(var u="function"==typeof require&&require,r=0;r<n.length;r++)t(n[r]);return t}({1:[function(){var e=function(){var i={},e=i.hasOwnProperty;return{subscribe:function(o,n){e.call(i,o)||(i[o]=[]);var t=i[o].push(n)-1;return{remove:function(){delete i[o][t]}}},publish:function(o,n){e.call(i,o)&&i[o].forEach(function(i){i(void 0!==n?n:{})})}}}(),o=function(){function o(i){this.num=i,this.id="cube-"+i,this.$el=$("#"+this.id),this.value=1;var e=this;if(this.$el.on("click",function(){e.choose()}),0===this.$el.length)throw"Die number "+i+" does not exist"}var n,t,u,r,c,s=5,l=!0,a=!1,f=!1,h=[],d=[],v=0,p=500,b=0,m={1:"show-front",2:"show-back",3:"show-right",4:"show-left",5:"show-top",6:"show-bottom"},g={fmgs:"The Five-Minute Geek Show","mildly-alarming":"The Mildly Alarming Podcast"};o.prototype={removeFromLive:function(){var i=this;h=h.filter(function(e){return e.id!=i.id})},choose:function(){if(!this.isLive())return void F("Not live, no choos-y");if(f)return void O("You cannot choose a die until you roll again.");if(!a)return void O("You cannot choose a die until you have rolled.");if(this.value<v)return void O("You can't choose dice with a value lower than your match.");this.value>v&&(v=this.value);var i=this;sameValueDice=h.filter(function(e){return e.value==i.value});for(var o in sameValueDice)sameValueDice[o].moveToPool();e.publish("die.chosen",this)},moveToPool:function(){this.removeFromLive(),d.push(this),e.publish("die.movedToPool",this)},isLive:function(){var i=this,e=h.filter(function(e){return e.id==i.id});return e.length>0},roll:function(){var i=q();this.value=i,e.publish("die.rolled",this)}};var w=function(){e.subscribe("dice.rolled",function(){$(".cube-wrapper").removeClass("queued")}),e.subscribe("dice.rolled",function(){a=!0,f=!1}),e.subscribe("dice.rolled",function(){D.liveAllowsFutureChoosing()}),e.subscribe("die.chosen",function(){$("#quit-and-score").css("display","inline-block")}),e.subscribe("die.chosen",function(){f=!0,a=!1,P.updateScore(),D.liveContainsDice()}),e.subscribe("die.movedToPool",function(i){i.$el.closest(".cube-wrapper").detach().appendTo(t)}),e.subscribe("die.rolled",function(i){i.$el[0].className="cube "+m[i.value]}),e.subscribe("score.changed",function(){u.text(b)}),e.subscribe("play.scoredOut",function(){O("You got "+b+" point(s) for "+g[c]),$.ajax({method:"POST",url:"/api/games",data:{points:b,podcast:c},success:function(i){F(i)}}),$("#screen").css("display","block")})},y=function(){for(i=1;i<=s;i++)h.push(new o(i));n=$("#live-container"),t=$("#match-container"),u=$("#current-score"),r=$("#roll-button"),r.on("click",function(){k()}),$("#quit-and-score").on("click",function(){F("Quitting because quit and score button pressed."),P.quitAndScore()}),$(".pick-a-podcast__button").on("click",function(){T($(this).data("podcast-slug")),$(".pick-a-podcast").hide(),$(".wrapper").show()}),w()},T=function(i){c=i},k=function(){if(a)return void O("You can't roll again until you choose.");for(var i in h)h[i].roll();e.publish("dice.rolled")},q=function(){return Math.round(5*Math.random())+1},x=function(i){setTimeout(i,p)},D={liveAllowsFutureChoosing:function(){for(var i in h)if(h[i].value>=v)return;x(function(){O("Fail roll!"),P.failRoll()})},liveContainsDice:function(){0===h.length&&(F("Quitting because live length is 0"),r.hide())}},O=function(i){var e=$('<div class="alert">').text(i);$("#notifications").append(e),setTimeout(function(){e.slideUp()},3e3)},F=function(i){l&&console.log(i)},P={failRoll:function(){b=1,e.publish("score.changed"),e.publish("play.scoredOut")},updateScore:function(){var i=0;for(var o in d)i+=d[o].value;b=i,e.publish("score.changed")},quitAndScore:function(){this.updateScore(),e.publish("play.scoredOut")}};return{init:y}}();$(function(){o.init()})},{}]},{},[1]);