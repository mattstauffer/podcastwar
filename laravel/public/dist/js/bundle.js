!function o(i,e,n){function t(u,c){if(!e[u]){if(!i[u]){var s="function"==typeof require&&require;if(!c&&s)return s(u,!0);if(r)return r(u,!0);var l=new Error("Cannot find module '"+u+"'");throw l.code="MODULE_NOT_FOUND",l}var a=e[u]={exports:{}};i[u][0].call(a.exports,function(o){var e=i[u][1][o];return t(e?e:o)},a,a.exports,o,i,e,n)}return e[u].exports}for(var r="function"==typeof require&&require,u=0;u<n.length;u++)t(n[u]);return t}({1:[function(){var o=function(){var o={},i=o.hasOwnProperty;return{subscribe:function(e,n){i.call(o,e)||(o[e]=[]);var t=o[e].push(n)-1;return{remove:function(){delete o[e][t]}}},publish:function(e,n){i.call(o,e)&&o[e].forEach(function(o){o(void 0!==n?n:{})})}}}(),e=function(){function e(o){this.num=o,this.id="cube-"+o,this.$el=$("#"+this.id),this.value=1;var i=this;if(this.$el.on("click",function(){i.choose()}),0===this.$el.length)throw"Die number "+o+" does not exist"}var n,t,r,u,c,s,l=5,a=0,f=!0,h=!1,d=!1,v=[],p=[],b=0,m=500,w=0,g={1:"show-front",2:"show-back",3:"show-right",4:"show-left",5:"show-top",6:"show-bottom"},y={fmgs:"The Five-Minute Geek Show","mildly-alarming":"The Mildly Alarming Podcast"};e.prototype={choose:function(){if(!this.isLive())return void D("Not live, no choos-y");if(d)return void O("You cannot choose a die until you roll again.");if(!h)return void O("You cannot choose a die until you have rolled.");if(this.value<b)return void O("You can't choose dice with a value lower than your match.");this.value>b&&(b=this.value,c.text(b));var i=this;sameValueDice=v.filter(function(o){return o.value==i.value});for(var e in sameValueDice)sameValueDice[e].moveToPool();o.publish("die.chosen",this)},removeFromLive:function(){var o=this;v=v.filter(function(i){return i.id!=o.id})},moveToPool:function(){this.removeFromLive(),p.push(this),o.publish("die.movedToPool",this)},removeFromPool:function(){var o=this;p=p.filter(function(i){return i.id!=o.id})},moveToLive:function(){this.removeFromPool(),v.push(this),o.publish("die.movedToLive",this)},isLive:function(){var o=this,i=v.filter(function(i){return i.id==o.id});return i.length>0},roll:function(){var i=x();this.value=i,o.publish("die.rolled",this)}};var k=function(){o.subscribe("dice.rolling",function(){if(!F())for(a=A.getPoolScore();p.length>0;)p[0].moveToLive()}),o.subscribe("dice.rolled",function(){$(".cube-wrapper").removeClass("queued")}),o.subscribe("dice.rolled",function(){h=!0,d=!1}),o.subscribe("dice.rolled",function(){L.liveAllowsFutureChoosing()}),o.subscribe("die.chosen",function(){$("#quit-and-score").css("display","inline-block")}),o.subscribe("die.chosen",function(){d=!0,h=!1,A.updateScore()}),o.subscribe("die.movedToPool",function(o){o.$el.closest(".cube-wrapper").detach().appendTo(t)}),o.subscribe("die.movedToLive",function(o){o.$el.closest(".cube-wrapper").detach().appendTo(n)}),o.subscribe("die.rolled",function(o){o.$el[0].className="cube "+g[o.value]}),o.subscribe("score.changed",function(){r.text(w)}),o.subscribe("play.scoredOut",function(){O("You got "+w+" point(s) for "+y[s]),$.ajax({method:"POST",url:"/api/games",data:{points:w,podcast:s},success:function(o){D(o)}}),$("#screen").css("display","block")})},T=function(){for(i=1;i<=l;i++)v.push(new e(i));n=$("#live-container"),t=$("#match-container"),r=$("#current-score"),u=$("#roll-button"),c=$("#max-die"),u.on("click",function(){q()}),$("#quit-and-score").on("click",function(){D("Quitting because quit and score button pressed."),A.quitAndScore()}),$(".pick-a-podcast__button").on("click",function(){P($(this).data("podcast-slug")),$(".pick-a-podcast").hide(),$(".wrapper").show()}),$("#how-it-works-button").on("click",function(o){o.preventDefault(),o.stopPropagation(),$("#how-it-works-container").show(),$("body").on("click.hiw-esecape",function(){$("#how-it-works-container").hide(),$("body").off("click.hiwescape")})}),k()},P=function(o){s=o},q=function(){if(h)return void O("You can't roll again until you choose.");o.publish("dice.rolling");for(var i in v)v[i].roll();o.publish("dice.rolled")},x=function(){return Math.round(5*Math.random())+1},S=function(o){setTimeout(o,m)},F=function(){return 0!==v.length},L={liveAllowsFutureChoosing:function(){for(var o in v)if(v[o].value>=b)return;S(function(){O("Fail roll!"),A.failRoll()})}},O=function(o){var i=$('<div class="alert">').text(o);$("#notifications").append(i),setTimeout(function(){i.slideUp()},3e3)},D=function(o){f&&console.log(o)},A={failRoll:function(){w=1,o.publish("score.changed"),o.publish("play.scoredOut")},getPoolScore:function(){var o=0;for(var i in p)o+=p[i].value;return o},updateScore:function(){w=this.getPoolScore()+a,o.publish("score.changed")},quitAndScore:function(){this.updateScore(),o.publish("play.scoredOut")}};return{init:T}}();$(function(){e.init()})},{}]},{},[1]);